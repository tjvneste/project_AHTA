pe <- msqrob(object = pe, i = "proteinRobust", formula = ~condition)
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[1]])
condition
pe <- msqrob(object = pe, i = "proteinRobust", formula = ~condition)
pe
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[1]])
pe$condition
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[1]])
colData(pe)$condition <- as.factor(c(rep('LA',3),rep('LV',3),rep('RA',3),rep('RV',3)))
MSnbase::plotNA(assay(pe[["peptideRaw"]])) +
xlab("Peptide index (ordered by data completeness)")
boxplot(assay(pe[["peptideNorm"]]), col = palette()[-1],
main = "Peptide distribtutions after normalisation", ylab = "intensity")
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[2]])
colData(pe)$condition <- as.factor(c(rep('LA',3),rep('LV',3),rep('RA',3),rep('RV',3)))
colData(pe)$condition
colData(pe)
colData(pe)$sample <- as.factor(rep(c(3,4,8),4)
)
colData(pe)
pe <- msqrob(object = pe, i = "proteinRobust", formula = ~condition+ sample)
pe <- msqrob(object = pe, i = "proteinRobust", formula = ~condition+ sample, overwrite=TRUE)
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[2]])
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[1]])
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[2]])
L <- makeContrast("conditionLV=0", parameterNames = c("conditionLV"))
pe <- hypothesisTest(object = pe, i = "proteinRobust", contrast = L)
volcano <- ggplot(rowData(pe[["proteinRobust"]])$conditionLV,
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano
L <- makeContrast("conditionRA=0", parameterNames = c("conditionLV"))
L <- makeContrast("conditionRA=0", parameterNames = c("conditionRA"))
pe <- hypothesisTest(object = pe, i = "proteinRobust", contrast = L)
volcano <- ggplot(rowData(pe[["proteinRobust"]])$conditionRA,
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano
pe <- msqrob(object = pe, i = "proteinRobust", formula = ~0+ condition+ sample, overwrite=TRUE)
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[2]])
L <- makeContrast("conditionLA=conditionRA", parameterNames = c("conditionLA",'conditionRA'))
L <- makeContrast("conditionLA-conditionRA=0", parameterNames = c("conditionLA",'conditionRA'))
pe <- hypothesisTest(object = pe, i = "proteinRobust", contrast = L)
pe
pe[[4]]
pe[[proteinRobust]]
pe[['proteinRobust']]
rowData(pe[["proteinRobust”]])[“conditionLA - conditionRA”]
)
d
))
exit
L <- makeContrast("conditionLA-conditionRA=0", parameterNames = c("conditionLA",'conditionRA'))
L <- makeContrast("conditionLA-conditionRA=0", parameterNames = c("conditionLA",'conditionRA'))
pe <- hypothesisTest(object = pe, i = "proteinRobust", contrast = L)
volcano <- ggplot(rowData(pe[["proteinRobust"]])["conditionLA - conditionRA"],
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
rowData(pe[["proteinRobust”]])[“conditionLA - conditionRA”]
rowData(pe[["proteinRobust']])['conditionLA - conditionRA']
rowData(pe[["proteinRobust']])['conditionLA - conditionRA']
rowData(pe[['proteinRobust']])['conditionLA - conditionRA']
rowData(pe[['proteinRobust']])['conditionLA - conditionRA']
L <- makeContrast("conditionLA=0", parameterNames = c("conditionLA"))
L1 <- makeContrast("conditionRA=0", parameterNames = c("conditionRA"))
pe <- hypothesisTest(object = pe, i = "proteinRobust", contrast = L-L1)
pe
pe[['proteinRobust']]
pe <- msqrob(object = pe, i = "proteinRobust", formula = ~0 + condition + sample, overwrite=TRUE)
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[2]])
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[3]])
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[2]])
L <- makeContrast("conditionLA=0", parameterNames = c("conditionLA"))
pe <- hypothesisTest(object = pe, i = "proteinRobust", contrast = L)
pe <- hypothesisTest(object = pe, i = "proteinRobust", contrast = L,overwrite=TRUE)
volcano <- ggplot(rowData(pe[["proteinRobust"]])$conditionLA,
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano
L <- makeContrast(c("conditionLA-conditionLV=0","conditionRA-conditionRV=0","(conditionLA-conditionLV)-(conditionRA-conditionRV)"), parameterNames = c("conditionLA","conditionLV","conditionRV","conditionRA"))
L <- makeContrast(c("conditionLA-conditionLV=0","conditionRA-conditionRV=0","(conditionLA-conditionLV)-(conditionRA-conditionRV)=0"), parameterNames = c("conditionLA","conditionLV","conditionRV","conditionRA"))
pe <- hypothesisTest(object = pe, i = "proteinRobust", contrast = L,overwrite=TRUE)
pe[['proteinRobust']]
pe[['proteinRobust']] %>% rowData %>% names()
volcano <- ggplot(rowData(pe[["proteinRobust"]])$conditionLA - conditionLV,
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano <- ggplot(rowData(pe[["proteinRobust"]])$conditionLA-conditionLV,
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano <- ggplot(rowData(pe[["proteinRobust"]])["conditionLA-conditionLV"],
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
pe[['proteinRobust']] %>% rowData %>% names()
volcano <- ggplot(rowData(pe[["proteinRobust"]])["conditionLA - conditionLV"],
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano <- ggplot(pe[["proteinRobust"]])%>%rowData %>% ["conditionLA - conditionLV"],
volcano <- ggplot(pe[["proteinRobust"]]) %>% rowData %>% "conditionLA - conditionLV",
volcano <- ggplot(pe[["proteinRobust"]]) %>% rowData %>% conditionLA - conditionLV,
volcano <- ggplot(pe[['proteinRobust']]) %>% rowData %>% conditionLA - conditionLV,
pe[['proteinRobust']]) %>% rowData %>% conditionLA - conditionLV
volcano <- ggplot(pe[['proteinRobust']] %>% rowData %>% conditionLA - conditionLV),
volcano <- ggplot(pe[['proteinRobust']] %>% rowData %>% conditionLA - conditionLV)+
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
rowData(pe[["proteinRobust"]])
volcano <- ggplot(rowData(pe[["proteinRobust"]])$conditionLA - conditionLV,
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano <- ggplot(rowData(pe[["proteinRobust"]])$conditionLA-conditionLV,
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano <- ggplot(rowData(pe[["proteinRobust"]])$(conditionLA-conditionLV),
volcano <- ggplot(rowData(pe[["proteinRobust"]])$[conditionLA - conditionLV],
pe
pe %>% proteinRobust
pe[[proteinRobust]]
pe %>% "proteinRobust"
pe[["proteinRobust"]]
pe[["proteinRobust"]] %>% rowData names()
pe[["proteinRobust"]] %>% rowData names
pe[["proteinRobust"]] %>% rowData
pe[["proteinRobust"]] %>% rowData %>% names
pe[["proteinRobust"]] %>% rowData %>% names %>% conditionRA - conditionRV
pe[["proteinRobust"]] %>% rowData %>% names %>% (conditionRA - conditionRV)
pe[["proteinRobust"]] %>% rowData %>% names %>% [conditionRA - conditionRV]
pe[["proteinRobust"]] %>% rowData %>% names %>% conditionRA-conditionRV
pe[["proteinRobust"]] %>% rowData %>% names
pe[["proteinRobust"]] %>% rowData %>% names[19]
pe[["proteinRobust"]] %>% rowData %>% names(19)
pe[["proteinRobust"]] %>% rowData %>% names(1)
pe[["proteinRobust"]] %>% rowData %>% names()
pe[["proteinRobust"]] %>% rowData %>% names
pe[["proteinRobust"]] %>% rowData %>% names[5]
pe[["proteinRobust"]][rowData] %>% names
pe[["proteinRobust"]][rowData]
pe[["proteinRobust"]][[rowData]
]
pe[["proteinRobust"]]
pe[["proteinRobust"]]`.rowNamesDF<-`()
rowData(pe[["proteinRobust"]])
library(tidyverse)
library(limma)
library(QFeatures)
library(QFeatures)
library(msqrob2)
library(plotly)
peptidesFile <- "https://raw.githubusercontent.com/statOmics/SGA2020/data/quantification/heart/peptides.txt"
ecols <- MSnbase::grepEcols(
peptidesFile,
"Intensity ",
split = "\t")
colData(pe)$condition <- as.factor(c(rep('LA',3),rep('LV',3),rep('RA',3),rep('RV',3)))
cond <- which(
strsplit(colnames(pe)[[1]][1], split = "")[[1]] == "A") # find where condition is stored
colData(pe)$condition <- as.factor(c(rep('LA',3),rep('LV',3),rep('RA',3),rep('RV',3)))
colData(pe)$condition
peptidesFile <- "https://raw.githubusercontent.com/statOmics/SGA2020/data/quantification/heart/peptides.txt"
ecols <- MSnbase::grepEcols(
peptidesFile,
"Intensity ",
split = "\t")
pe <- readQFeatures(
table = peptidesFile,
fnames = 1,
ecol = ecols,
name = "peptideRaw", sep="\t")
colData(pe)$condition
colData(pe)$condition <- as.factor(c(rep('LA',3),rep('LV',3),rep('RA',3),rep('RV',3)))
colData(pe)$sample <- as.factor(rep(c(3,4,8),4))
rowData(pe[["peptideRaw"]])$nNonZero <- rowSums(assay(pe[["peptideRaw"]]) > 0)
pe <- zeroIsNA(pe, "peptideRaw") # convert 0 to NA
MSnbase::plotNA(assay(pe[["peptideRaw"]])) +
xlab("Peptide index (ordered by data completeness)")
pe <- logTransform(pe, base = 2, i = "peptideRaw", name = "peptideLog")
pe[["peptideLog"]] <-
pe[["peptideLog"]][rowData(pe[["peptideLog"]])$Proteins
%in% smallestUniqueGroups(rowData(pe[["peptideLog"]])$Proteins),]
pe[["peptideLog"]] <- pe[["peptideLog"]][rowData(pe[["peptideLog"]])$
Potential.contaminant != "+", ]
pe[["peptideLog"]] <- pe[["peptideLog"]][rowData(pe[["peptideLog"]])$nNonZero >= 2, ]
nrow(pe[["peptideLog"]])
pe <- normalize(pe, i = "peptideLog", method = "quantiles", name = "peptideNorm")
limma::plotDensities(assay(pe[["peptideNorm"]]))
boxplot(assay(pe[["peptideNorm"]]), col = palette()[-1],
main = "Peptide distribtutions after normalisation", ylab = "intensity")
limma::plotMDS(assay(pe[["peptideNorm"]]), col = as.numeric(colData(pe)$condition))
pe <- aggregateFeatures(pe,
i = "peptideNorm",
fcol = "Proteins",
na.rm = TRUE,
name = "proteinRobust",
fun = MsCoreUtils::robustSummary)
plotMDS(assay(pe[["proteinRobust"]]), col = as.numeric(colData(pe)$condition))
pe <- msqrob(object = pe, i = "proteinRobust", formula = ~0 + condition + sample, overwrite=TRUE)
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[2]])
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[1]]) # first one has too many NAN
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[2]]) # first one has too many NAN
L <- makeContrast(c("conditionLA-conditionLV=0","conditionRA-conditionRV=0","(conditionLA-conditionLV)-(conditionRA-conditionRV)=0"), parameterNames = c("conditionLA","conditionLV","conditionRV","conditionRA"))
pe <- hypothesisTest(object = pe, i = "proteinRobust", contrast = L,overwrite=TRUE)
volcano <- ggplot(rowData(pe[["proteinRobust"]])$contrast,
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano
volcano <- ggplot(rowData(pe[["proteinRobust"]])$contrast,
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano
library(tidyverse)
library(limma)
library(QFeatures)
library(msqrob2)
library(plotly)
volcano <- ggplot(rowData(pe[["proteinRobust"]])$contrast,
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano
library(ggplot2)
volcano
library(ggplot)
sigNames <- rowData(pe[["proteinRobust"]])$contrast %>%
rownames_to_column("proteinRobust") %>%
filter(adjPval<0.05) %>%
pull(proteinRobust)
rowData(pe[["proteinRobust"]])$
)
rowData(pe[["proteinRobust"]])
names(rowData(pe[["proteinRobust"]]))
rowData(pe[["proteinRobust"]])"conditionLA - conditionLV"
volcano <- ggplot(rowData(pe[["proteinRobust"]])$'conditionLA-conditionLV',
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano
rowData(pe[["proteinRobust"]])$'conditionLA-conditionLV' %>% head()
rowData(pe[["proteinRobust"]]) %>% names
rowData(pe[["proteinRobust"]]) %>% head()
rowData(pe[["proteinRobust"]])[,13] %>% head()
rowData(pe[["proteinRobust"]])[,14] %>% head()
rowData(pe[["proteinRobust"]]) %>% names
volcano <- ggplot(rowData(pe[["proteinRobust"]])[,14],
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano
volcano <- ggplot(rowData(pe[["proteinRobust"]])[,15],
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano
volcano <- ggplot(rowData(pe[["proteinRobust"]])[,14],
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano
volcano <- ggplot(rowData(pe[["proteinRobust"]])[,14],
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano2 <- ggplot(rowData(pe[["proteinRobust"]])[,15],
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano3 <- ggplot(rowData(pe[["proteinRobust"]])[,16],
aes(x = logFC, y = -log10(pval), color = adjPval < 0.05)) +
geom_point(cex = 2.5) +
scale_color_manual(values = alpha(c("black", "red"), 0.5)) + theme_minimal()
volcano3
volcano
volcano2
volcano
volcano2
volcano3
sigNames <- rowData(pe[["proteinRobust"]])[,14] %>%
rownames_to_column("proteinRobust") %>%
filter(adjPval<0.05) %>%
pull(proteinRobust)
heatmap(assay(pe[["proteinRobust"]])[sigNames, ])
sigNames <- rowData(pe[["proteinRobust"]])[,15] %>%
rownames_to_column("proteinRobust") %>%
filter(adjPval<0.05) %>%
pull(proteinRobust)
heatmap(assay(pe[["proteinRobust"]])[sigNames, ])
sigNames <- rowData(pe[["proteinRobust"]])[,14] %>%
rownames_to_column("proteinRobust") %>%
filter(adjPval<0.05) %>%
pull(proteinRobust)
heatmap(assay(pe[["proteinRobust"]])[sigNames, ])
sigNames <- rowData(pe[["proteinRobust"]])[,16] %>%
rownames_to_column("proteinRobust") %>%
filter(adjPval<0.05) %>%
pull(proteinRobust)
heatmap(assay(pe[["proteinRobust"]])[sigNames, ])
rowData(pe[["proteinRobust"]])[,14] %>%
rownames_to_column(var = "protein") %>%
ggplot(aes(x=grepl("UPS",protein),y=logFC)) +
geom_boxplot() +
xlab("UPS") +
geom_segment(
x = 1.5,
xend = 2.5,
y = log2(0.74/0.25),
yend = log2(0.74/0.25),
colour="red") +
geom_segment(
x = 0.5,
xend = 1.5,
y = 0,
yend = 0,
colour="red") +
annotate(
"text",
x = c(1,2),
y = c(0,log2(0.74/0.25))+.1,
label = c(
"log2 FC Ecoli = 0",
paste0("log2 FC UPS = ",round(log2(0.74/0.25),2))
),
colour = "red")
rowData(pe[["proteinRobust"]])[,14] %>%
rownames_to_column(var = "protein") %>%
ggplot(aes(x=grepl("condition",protein),y=logFC)) +
geom_boxplot() +
xlab("UPS") +
geom_segment(
x = 1.5,
xend = 2.5,
y = log2(0.74/0.25),
yend = log2(0.74/0.25),
colour="red") +
geom_segment(
x = 0.5,
xend = 1.5,
y = 0,
yend = 0,
colour="red") +
annotate(
"text",
x = c(1,2),
y = c(0,log2(0.74/0.25))+.1,
label = c(
"log2 FC Ecoli = 0",
paste0("log2 FC UPS = ",round(log2(0.74/0.25),2))
),
colour = "red")
rowData(pe[["proteinRobust"]])[,14] %>%
rownames_to_column(var = "condition") %>%
ggplot(aes(x=grepl("condition",protein),y=logFC)) +
geom_boxplot() +
xlab("UPS") +
geom_segment(
x = 1.5,
xend = 2.5,
y = log2(0.74/0.25),
yend = log2(0.74/0.25),
colour="red") +
geom_segment(
x = 0.5,
xend = 1.5,
y = 0,
yend = 0,
colour="red") +
annotate(
"text",
x = c(1,2),
y = c(0,log2(0.74/0.25))+.1,
label = c(
"log2 FC Ecoli = 0",
paste0("log2 FC UPS = ",round(log2(0.74/0.25),2))
),
colour = "red")
volcano2
volcano
pe <- msqrob(object = pe, i = "proteinRobust", formula = ~0 + condition * sample, overwrite=TRUE)
pe <- msqrob(object = pe, i = "proteinRobust", formula = ~0+ condition * sample, overwrite=TRUE)
pe <- msqrob(object = pe, i = "proteinRobust", formula = ~0+ condition + sample, overwrite=TRUE)
getCoef(rowData(pe[["proteinRobust"]])$msqrobModels[[2]]) # first one has too many NAN
# laptop
setwd("~/documenten/Documenten/Ugent/applied high-throughput analysis/project_AHTA/Transcription profiling of human breast tumors and their paired normal tissues")
## Load packages
library(affy)
library(arrayQualityMetrics)
library(ArrayExpress)
library(limma)
library(biomaRt)
?rma
# load in the expressionFeatureSet object
BreastCancer <- ArrayExpress("E-GEOD-15852")
# exprs functions returns the intensity values for each sample (column)
exprs(BreastCancer)
#pData returns the phenotypic data we loaded using ReadAffy
pData(BreastCancer)
# exprs functions returns the intensity values for each sample (column)
exprs(BreastCancer)
# Preprocessing of the data
# rma function is used to perform background correction as well as quantile normalization
BreastCancerRMA<- affy::rma(BreastCancer,background=T)
# Preprocessing of the data
# rma function is used to perform background correction as well as quantile normalization
BreastCancerRMA<- affy::rma(BreastCancer,background=T)
## Reads in all .cel files and takes phenoData from the ExpressionFeatureset we loaded using https_ArrayExpress
BreastCancer <- ReadAffy(phenoData=pData(BreastCancer))
# Preprocessing of the data
# rma function is used to perform background correction as well as quantile normalization
BreastCancerRMA<- affy::rma(BreastCancer,background=T)
exprs(BreastCancerRMA)
head(pData(BreastCancerRMA))
annot <- factor(pData(BreastCancerRMA)[,7]) # normal breast tissue and breast tumor tissue
annot
length(annot) # 86
annotb <- as.double(annot==annot[4]) # we want the breast tumor tissue to be one and the control to be zero
annotb
# the problem is we don't account for the persons but can we? bcs we have 86 samples? YES
pData(BreastCancerRMA)$Patients<- pData(BreastCancerRMA)$Hybridization.Name
pData(BreastCancerRMA)$Patients <- gsub('Normal', '',pData(BreastCancerRMA)$Patients)
pData(BreastCancerRMA)$Patients <- gsub('Cancer', '',pData(BreastCancerRMA)$Patients)
pData(BreastCancerRMA)$Patients <- gsub('T', '',pData(BreastCancerRMA)$Patients)
pData(BreastCancerRMA)$Patients <- gsub('N', '',pData(BreastCancerRMA)$Patients)
pData(BreastCancerRMA)$Patients <- gsub(' ', '',pData(BreastCancerRMA)$Patients)
pData(BreastCancerRMA)$Patients # this is column with patients every patient has to occur 2 times in this column
sum(grepl('BC0155', pData(BreastCancerRMA)$Patients))
sum(grepl('BC0117', pData(BreastCancerRMA)$Patients))
ID <- factor(pData(BreastCancerRMA)$Patients)
length(levels(ID))
## Differential expression by LIMMA
# why LIMMA? => Limma has more power than SAM
# Method as stated in limma package (no intercept, easy for simple model designs)
design <- model.matrix(~0+annot+ID)
colSums(design) # checking if this is correct
design
#patients toevoegen
colnames(design)[1:2]<-c("Cancer_breast_tissue","normal_breast_tissue")
?lmFit
citation("limma")
fit <- lmFit(BreastCancerRMA,design)
cont.matrix <- makeContrasts(NvsS=Cancer_breast_tissue-normal_breast_tissue,levels=design)
fit2 <- contrasts.fit(fit,cont.matrix)
fit2 <- eBayes(fit2)
LIMMAout <- topTable(fit2,adjust="BH",number=nrow(exprs(BreastCancerRMA)))
head(LIMMAout)
# Have a look at the results and search for other probesets for your DE genes
head(LIMMAout)
significant_pvalues_1<- LIMMAout[LIMMAout$adj.P.Val<0.05,]
dim(significant_pvalues_1)
head(significant_pvalues_1)
tail(significant_pvalues_1)
?getBM
setwd("~/documenten/Documenten/Ugent/applied high-throughput analysis/project_AHTA/methylation/GSE101443_RAW")
## Load packages
library('lumi')
library('wateRmelon')
library('ChAMPdata')
BiocManager::install("ChAMPdata",update=F)
library('ChAMPdata')
?readEPIC
methyldata <- readEPIC(getwd())
ID <- c('GSM2703232','GSM2703233', 'GSM2703234', 'GSM2703235', 'GSM2703236','GSM2703237', 'GSM2703238', 'GSM2703239')
condition <- c('Tumour_A','Normal_A','Tumour_B','Normal_B','Tumour_C','Normal_C','Tumour_D','Normal_D')
Patient <- c('A','A','B','B','C','C','D','D')
annotation <- data.frame(ID,condition,Patient)
## Have a look at the data and annotation
print(methyldata)
print(head(betas(methyldata))) # The “betas” function will retreive the beta values ( = methylation percentages) and the “exprs” function will retreive the M-values.
print(head(exprs(methyldata)))
## Change sampleNames to something more comprehensible
sampleNames(methyldata) <- annotation[,2]
sampleNames(methyldata)
## Remove NA values
methyldata <- methyldata[!(rowSums(is.na(exprs(methyldata)))>=1),]
methyldata
?t.test
## Remove NA values
methyldata <- methyldata[!(rowSums(is.na(exprs(methyldata)))>=1),]
methyldata
## Remove probes for which calling p-value is insufficient
methyldata.pf<-pfilter(methyldata)
## Comparison of average methylation between control and tumor samples
boxplot(betas(methyldata),las=2)
meth_mean_tumour <- rep(0,8)
meth_mean_control <- rep(0,8)
for (i in 1:ncol(methyldata)){
if((i %% 2) == 0) { # even
meth_mean_control[i] <- mean(betas(methyldata)[,i])
} else {
meth_mean_tumour[i] <- mean(betas(methyldata)[,i])
}
}
meth_mean_tumour <- meth_mean_tumour[c(1,3,5,7)]
meth_mean_control <- meth_mean_control[c(2,4,6,8)]
t_test_res <- t.test(meth_mean_control,meth_mean_tumour,var.equal=F)
t_test_res
dat_boxplot <- data.frame(betas = c(meth_mean_control,meth_mean_control),
group = c('Tumour','Normal','Tumour','Normal','Tumour','Normal','Tumour','Normal'))
boxplot(betas~group,dat_boxplot,las=2)
?dasen
## Perform normalization including dye color adjustment
methyldata.dasen.pf <- dasen(methyldata.pf)
citation("dasen")
citation("ChAMPdata")
